# èµèµæ˜Ÿé¡¹ç›®å®å¡”éƒ¨ç½²æŒ‡å—

## é¡¹ç›®æ¦‚è¿°

èµèµæ˜Ÿæ°›å›´è¥é€ å·¥å…·æ˜¯ä¸€ä¸ªåŸºäº React + Node.js çš„å…¨æ ˆåº”ç”¨ï¼ŒåŒ…å«å‰ç«¯ç®¡ç†ç•Œé¢å’Œåç«¯APIæœåŠ¡ã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React 18 + Ant Design + Webpack
- **åç«¯**: Node.js + Express + Prisma
- **æ•°æ®åº“**: MySQL/PostgreSQL
- **éƒ¨ç½²**: å®å¡”é¢æ¿ + Nginx

## ä¸€ã€æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

### 1.1 ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: CentOS 7+ / Ubuntu 18+ / Debian 9+
- **å†…å­˜**: æœ€ä½ 2GBï¼Œæ¨è 4GB+
- **ç¡¬ç›˜**: æœ€ä½ 20GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: å…¬ç½‘IPï¼Œå¼€æ”¾ 80ã€443ã€8888 ç«¯å£

### 1.2 å®‰è£…å®å¡”é¢æ¿
```bash
# CentOS å®‰è£…å‘½ä»¤
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec

# Ubuntu/Debian å®‰è£…å‘½ä»¤
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh ed8484bec
```

### 1.3 å®å¡”é¢æ¿åŸºç¡€é…ç½®
1. è®¿é—® `http://ä½ çš„æœåŠ¡å™¨IP:8888`
2. å®Œæˆå®å¡”é¢æ¿åˆå§‹åŒ–è®¾ç½®
3. å®‰è£…æ¨èå¥—ä»¶ï¼š
   - **Nginx**: 1.20+
   - **MySQL**: 5.7+ æˆ– 8.0+
   - **Node.js**: 16+ (é€šè¿‡è½¯ä»¶å•†åº—å®‰è£…)
   - **PM2**: è¿›ç¨‹ç®¡ç†å™¨

## äºŒã€é¡¹ç›®æ–‡ä»¶éƒ¨ç½²

### 2.1 ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
1. åœ¨å®å¡”é¢æ¿ä¸­åˆ›å»ºç½‘ç«™ç›®å½•ï¼š
   ```
   /www/wwwroot/praisestar.com
   ```

2. å°†é¡¹ç›®æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š
   ```bash
   # æ–¹å¼1: ä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸Šä¼ 
   # æ–¹å¼2: ä½¿ç”¨Gitå…‹éš†
   git clone https://github.com/your-repo/praisestar.git /www/wwwroot/praisestar.com
   
   # æ–¹å¼3: ä½¿ç”¨SCPä¸Šä¼ 
   scp -r ./PraiseStar root@your-server-ip:/www/wwwroot/praisestar.com
   ```

### 2.2 é¡¹ç›®ç›®å½•ç»“æ„
```
/www/wwwroot/praisestar.com/
â”œâ”€â”€ frontend/                 # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ webpack.config.js
â”‚   â””â”€â”€ dist/                # æ„å»ºåçš„æ–‡ä»¶
â”œâ”€â”€ backend/                  # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ .env
â”œâ”€â”€ nginx.conf               # Nginxé…ç½®
â””â”€â”€ ecosystem.config.js      # PM2é…ç½®
```

## ä¸‰ã€åç«¯éƒ¨ç½²

### 3.1 å®‰è£…Node.jsä¾èµ–
```bash
cd /www/wwwroot/praisestar.com/backend
npm install --production
```

### 3.2 é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="mysql://username:password@localhost:3306/praisestar"

# JWTé…ç½®
JWT_SECRET="your-super-secret-jwt-key"
JWT_EXPIRES_IN="7d"

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH="/www/wwwroot/praisestar.com/uploads"
MAX_FILE_SIZE=5242880

# é‚®ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰
SMTP_HOST="smtp.example.com"
SMTP_PORT=587
SMTP_USER="your-email@example.com"
SMTP_PASS="your-email-password"
```

### 3.3 æ•°æ®åº“åˆå§‹åŒ–
```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma db push

# å¯é€‰ï¼šå¡«å……åˆå§‹æ•°æ®
npx prisma db seed
```

### 3.4 åˆ›å»ºPM2é…ç½®æ–‡ä»¶
åˆ›å»º `ecosystem.config.js`ï¼š
```javascript
module.exports = {
  apps: [{
    name: 'praisestar-api',
    script: './src/app.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: '/www/wwwroot/praisestar.com/logs/err.log',
    out_file: '/www/wwwroot/praisestar.com/logs/out.log',
    log_file: '/www/wwwroot/praisestar.com/logs/combined.log',
    time: true,
    max_memory_restart: '1G',
    node_args: '--max_old_space_size=1024'
  }]
}
```

### 3.5 å¯åŠ¨åç«¯æœåŠ¡
```bash
# ä½¿ç”¨PM2å¯åŠ¨
pm2 start ecosystem.config.js

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

## å››ã€å‰ç«¯éƒ¨ç½²

### 4.1 å®‰è£…å‰ç«¯ä¾èµ–
```bash
cd /www/wwwroot/praisestar.com/frontend
npm install
```

### 4.2 ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®
ä¿®æ”¹ `src/services/config.js`ï¼š
```javascript
export const API_CONFIG = {
  BASE_URL: 'https://api.praisestar.com/api',  // ä¿®æ”¹ä¸ºä½ çš„APIåŸŸå
  // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
}
```

### 4.3 æ„å»ºå‰ç«¯é¡¹ç›®
```bash
npm run build
```

æ„å»ºå®Œæˆåï¼Œ`dist` ç›®å½•å°†åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶ã€‚

## äº”ã€Nginxé…ç½®

### 5.1 åˆ›å»ºNginxé…ç½®æ–‡ä»¶
åœ¨å®å¡”é¢æ¿ä¸­åˆ›å»ºç«™ç‚¹ï¼Œå¹¶é…ç½®Nginxï¼š

```nginx
server {
    listen 80;
    server_name praisestar.com www.praisestar.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name praisestar.com www.praisestar.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /www/server/panel/vhost/cert/praisestar.com/fullchain.pem;
    ssl_certificate_key /www/server/panel/vhost/cert/praisestar.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_prefer_server_ciphers on;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /www/wwwroot/praisestar.com/frontend/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
        
        # é™æ€èµ„æºç¼“å­˜
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:3000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads/ {
        alias /www/wwwroot/praisestar.com/uploads/;
        expires 1y;
        add_header Cache-Control "public";
    }
    
    # å®‰å…¨é…ç½®
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
    
    # æ—¥å¿—é…ç½®
    access_log /www/wwwlogs/praisestar.com.log;
    error_log /www/wwwlogs/praisestar.com.error.log;
}
```

### 5.2 é…ç½®SSLè¯ä¹¦
1. åœ¨å®å¡”é¢æ¿ä¸­ç”³è¯·Let's Encryptå…è´¹SSLè¯ä¹¦
2. æˆ–ä¸Šä¼ è‡ªå·±çš„SSLè¯ä¹¦æ–‡ä»¶

## å…­ã€æ•°æ®åº“é…ç½®

### 6.1 åˆ›å»ºæ•°æ®åº“
åœ¨å®å¡”é¢æ¿ä¸­ï¼š
1. è¿›å…¥æ•°æ®åº“ç®¡ç†
2. åˆ›å»ºæ–°æ•°æ®åº“ï¼š`praisestar`
3. åˆ›å»ºæ•°æ®åº“ç”¨æˆ·å¹¶æˆæƒ

### 6.2 é…ç½®æ•°æ®åº“è¿æ¥
ç¡®ä¿åç«¯ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ­£ç¡®ï¼š
```bash
DATABASE_URL="mysql://æ•°æ®åº“ç”¨æˆ·å:å¯†ç @localhost:3306/praisestar"
```

## ä¸ƒã€æ–‡ä»¶æƒé™é…ç½®

### 7.1 è®¾ç½®ç›®å½•æƒé™
```bash
# è®¾ç½®é¡¹ç›®ç›®å½•æƒé™
chown -R www:www /www/wwwroot/praisestar.com
chmod -R 755 /www/wwwroot/praisestar.com

# è®¾ç½®ä¸Šä¼ ç›®å½•æƒé™
mkdir -p /www/wwwroot/praisestar.com/uploads
chown -R www:www /www/wwwroot/praisestar.com/uploads
chmod -R 755 /www/wwwroot/praisestar.com/uploads

# è®¾ç½®æ—¥å¿—ç›®å½•æƒé™
mkdir -p /www/wwwroot/praisestar.com/logs
chown -R www:www /www/wwwroot/praisestar.com/logs
chmod -R 755 /www/wwwroot/praisestar.com/logs
```

## å…«ã€é˜²ç«å¢™é…ç½®

### 8.1 å¼€æ”¾å¿…è¦ç«¯å£
åœ¨å®å¡”é¢æ¿å®‰å…¨è®¾ç½®ä¸­å¼€æ”¾ï¼š
- **80**: HTTP
- **443**: HTTPS
- **8888**: å®å¡”é¢æ¿ï¼ˆå¯é€‰ï¼Œå»ºè®®ä¿®æ”¹é»˜è®¤ç«¯å£ï¼‰
- **3000**: åç«¯APIï¼ˆä»…å†…ç½‘è®¿é—®ï¼‰

### 8.2 é…ç½®å®‰å…¨ç»„
å¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨ï¼Œåœ¨äº‘æœåŠ¡å•†æ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™ã€‚

## ä¹ã€åŸŸåè§£æ

### 9.1 é…ç½®DNSè§£æ
åœ¨åŸŸåæœåŠ¡å•†å¤„æ·»åŠ Aè®°å½•ï¼š
```
ç±»å‹: A
ä¸»æœºè®°å½•: @
è®°å½•å€¼: ä½ çš„æœåŠ¡å™¨IP
TTL: 600

ç±»å‹: A
ä¸»æœºè®°å½•: www
è®°å½•å€¼: ä½ çš„æœåŠ¡å™¨IP
TTL: 600

ç±»å‹: A
ä¸»æœºè®°å½•: api
è®°å½•å€¼: ä½ çš„æœåŠ¡å™¨IP
TTL: 600
```

## åã€éƒ¨ç½²éªŒè¯

### 10.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥PM2è¿›ç¨‹
pm2 status

# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -uç”¨æˆ·å -p -e "SHOW DATABASES;"
```

### 10.2 åŠŸèƒ½æµ‹è¯•
1. **å‰ç«¯è®¿é—®**: `https://praisestar.com`
2. **APIæµ‹è¯•**: `https://api.praisestar.com/api/health`
3. **ç™»å½•åŠŸèƒ½**: æµ‹è¯•ç”¨æˆ·ç™»å½•
4. **æ–‡ä»¶ä¸Šä¼ **: æµ‹è¯•å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
5. **æ•°æ®åº“æ“ä½œ**: æµ‹è¯•å¢åˆ æ”¹æŸ¥åŠŸèƒ½

## åä¸€ã€æ€§èƒ½ä¼˜åŒ–

### 11.1 å‰ç«¯ä¼˜åŒ–
```bash
# å¯ç”¨Gzipå‹ç¼©
# åœ¨Nginxé…ç½®ä¸­æ·»åŠ ï¼š
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
```

### 11.2 åç«¯ä¼˜åŒ–
```javascript
// PM2é…ç½®ä¼˜åŒ–
module.exports = {
  apps: [{
    name: 'praisestar-api',
    script: './src/app.js',
    instances: 'max',  // ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
    exec_mode: 'cluster',
    max_memory_restart: '1G',
    node_args: '--max_old_space_size=1024'
  }]
}
```

### 11.3 æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºå¿…è¦çš„ç´¢å¼•
CREATE INDEX idx_users_phone ON users(phone);
CREATE INDEX idx_stars_created_at ON stars(created_at);
CREATE INDEX idx_gifts_status ON gifts(status);
```

## åäºŒã€ç›‘æ§ä¸ç»´æŠ¤

### 12.1 æ—¥å¿—ç›‘æ§
```bash
# æŸ¥çœ‹PM2æ—¥å¿—
pm2 logs praisestar-api

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /www/wwwlogs/praisestar.com.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/praisestar.com.error.log
```

### 12.2 å®šæœŸå¤‡ä»½
1. **æ•°æ®åº“å¤‡ä»½**: åœ¨å®å¡”é¢æ¿ä¸­è®¾ç½®è‡ªåŠ¨å¤‡ä»½
2. **æ–‡ä»¶å¤‡ä»½**: å®šæœŸå¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶
3. **ä»£ç å¤‡ä»½**: ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶

### 12.3 æ›´æ–°éƒ¨ç½²
```bash
# æ›´æ–°ä»£ç 
cd /www/wwwroot/praisestar.com
git pull origin main

# æ›´æ–°åç«¯
cd backend
npm install
npx prisma generate
pm2 restart praisestar-api

# æ›´æ–°å‰ç«¯
cd ../frontend
npm install
npm run build
# é‡å¯Nginx
systemctl reload nginx
```

## åä¸‰ã€å¸¸è§é—®é¢˜è§£å†³

### 13.1 502 Bad Gateway
```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
pm2 status

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 3000

# é‡å¯åç«¯æœåŠ¡
pm2 restart praisestar-api
```

### 13.2 æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡
systemctl status mysql

# æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™
mysql -uç”¨æˆ·å -p -e "SHOW GRANTS;"

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -uç”¨æˆ·å -p -h localhost praisestar
```

### 13.3 æ–‡ä»¶ä¸Šä¼ å¤±è´¥
```bash
# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
ls -la /www/wwwroot/praisestar.com/uploads

# æ£€æŸ¥Nginxé…ç½®
nginx -t

# æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶
# åœ¨Nginxé…ç½®ä¸­è°ƒæ•´ client_max_body_size
```

### 13.4 SSLè¯ä¹¦é—®é¢˜
```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
ls -la /www/server/panel/vhost/cert/praisestar.com/

# é‡æ–°ç”³è¯·è¯ä¹¦
# åœ¨å®å¡”é¢æ¿ä¸­é‡æ–°ç”³è¯·Let's Encryptè¯ä¹¦
```

## åå››ã€å®‰å…¨å»ºè®®

### 14.1 æœåŠ¡å™¨å®‰å…¨
1. å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶åŒ…
2. é…ç½®é˜²ç«å¢™è§„åˆ™
3. ä½¿ç”¨å¼ºå¯†ç 
4. ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

### 14.2 åº”ç”¨å®‰å…¨
1. å®šæœŸæ›´æ–°ä¾èµ–åŒ…
2. ä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“
3. é…ç½®CORSç­–ç•¥
4. å®æ–½è®¿é—®æ§åˆ¶

### 14.3 æ•°æ®å®‰å…¨
1. å®šæœŸå¤‡ä»½æ•°æ®åº“
2. åŠ å¯†æ•æ„Ÿæ•°æ®
3. å®æ–½æ•°æ®è®¿é—®å®¡è®¡
4. é…ç½®æ•°æ®ä¿ç•™ç­–ç•¥

## åäº”ã€è”ç³»æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£å’ŒREADME
2. æ£€æŸ¥GitHub Issues
3. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

**éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„èµèµæ˜Ÿé¡¹ç›®å°†åœ¨ä»¥ä¸‹åœ°å€è®¿é—®ï¼š**
- å‰ç«¯: `https://praisestar.com`
- API: `https://api.praisestar.com/api`

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
